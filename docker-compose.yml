# Docker Compose v2 - version obsolète supprimée
services:
  backend:
    build: ./liveshop-backend
    environment:
      - VIRTUAL_HOST=api.livelink.store
      - LETSENCRYPT_HOST=api.livelink.store
      - LETSENCRYPT_EMAIL=skhadimsall@gmail.com
      - NODE_ENV=production
      - DATABASE_URL=postgresql://liveshop_user:motdepassefort@fitsen-postgresql:5432/liveshop
    ports:
      - "3001:3001"
    volumes:
      # Volumes Docker nommés pour une vraie persistance
      - liveshop_database:/app/database
      - liveshop_uploads:/app/uploads
      - liveshop_logs:/app/logs
      # Volume pour les données utilisateur
      - liveshop_userdata:/app/userdata
    networks:
      - nginx-proxy
      - fitsen-backend_fitsen-network
    restart: unless-stopped

  dashboard:
    build: ./web-client/liveshop-client
    environment:
      - VIRTUAL_HOST=livelink.store
      - LETSENCRYPT_HOST=livelink.store
      - LETSENCRYPT_EMAIL=skhadimsall@gmail.com
      - NGINX_PROXY_CONTAINER=1
    networks:
      - nginx-proxy
    restart: unless-stopped

  mobile:
    build: ./mobile-app/liveshop-vendor
    environment:
      - VIRTUAL_HOST=space.livelink.store
      - LETSENCRYPT_HOST=space.livelink.store
      - LETSENCRYPT_EMAIL=skhadimsall@gmail.com
      - NGINX_PROXY_CONTAINER=1
    networks:
      - nginx-proxy
    restart: unless-stopped

# Volumes Docker nommés pour la persistance
volumes:
  liveshop_database:
    driver: local
  liveshop_uploads:
    driver: local
  liveshop_logs:
    driver: local
  liveshop_userdata:
    driver: local

networks:
  nginx-proxy:
    external: true
  fitsen-backend_fitsen-network:
    external: true